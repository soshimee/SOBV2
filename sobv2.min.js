(async()=>{!function(){var e=window,t="___grecaptcha_cfg",n=e[t]=e[t]||{},o="grecaptcha",r=e[o]=e[o]||{};r.ready=r.ready||function(e){(n.fns=n.fns||[]).push(e)},e.__recaptcha_api="https://www.google.com/recaptcha/api2/",(n.render=n.render||[]).push("onload"),e.__google_recaptcha_client=!0;var s=document,i=s.createElement("script");i.type="text/javascript",i.async=!0,i.src="https://www.gstatic.com/recaptcha/releases/CHIHFAf1bjFPOjwwi5Xa4cWR/recaptcha__ko.js",i.crossOrigin="anonymous",i.integrity="sha384-3ixG05K3/O+UzfsLo88Ri1RQG5M4r7McMuhCB2e0QHP2rfu2zlqugMd4PrILOX5Z";var a=s.querySelector("script[nonce]"),c=a&&(a.nonce||a.getAttribute("nonce"));c&&i.setAttribute("nonce",c);var l=s.getElementsByTagName("script")[0];l.parentNode.insertBefore(i,l)}();let e,t=!0;window.OPM||(t=!1,alert("OPM not loaded! Attempting to load... (install manually if not working)"),WebSocket.prototype.send=function(){this.close(),t=!0},await new Promise(e=>{const n=setInterval(()=>{t&&(clearInterval(n),e())},100)}),document.write(await(await fetch("https://opm.dimden.dev/client/")).text()),document.close(),await function(e){return new Promise(t=>setTimeout(t,e))}(1e4)),(()=>{const t=(()=>{window=this;const t=e=>console.error("%c "+e,"color: #ff0000"),n=()=>new Promise(e=>{OWOP.windowSys.addWindow(new OWOP.windowSys.class.window("Verification needed",{closeable:!0},function(t){grecaptcha.render(t.addObj(OWOP.util.mkHTML("div",{})),{theme:"dark",sitekey:"6LcgvScUAAAAAARUXtwrM8MP0A0N70z4DHNJh-KI",callback:function(n){t.close(),e(n)}})}))});class o{constructor(){this.chunks=[],this.chunkProtected=[]}setChunk(e,n,o){return o&&"number"==typeof e&&"number"==typeof n?("Array"!==o.constructor.name&&(o=Array.from(o)),this.chunks[e]||(this.chunks[e]=[]),this.chunks[e][n]=o):t("ChunkSystem.setChunk: failed to set chunk (no data or invalid coords).")}getChunk(e,t,n){if(n||(e=Math.floor(e/s.options.chunkSize),t=Math.floor(t/s.options.chunkSize)),this.chunks[e])return this.chunks[e][t]}removeChunk(e,t){if(this.chunks[e]&&this.chunks[e][t])return this.chunks[e].splice(t,1)}setPixel(e,n,o){if(!o||"object"!=typeof o||"number"!=typeof e||"number"!=typeof n)return t("ChunkSystem.setPixel: failed to set pixel (no/wrong rgb or invalid coords).");const r=Math.floor(e/s.options.chunkSize),i=Math.floor(n/s.options.chunkSize);if(!this.chunks[r])return;const a=this.chunks[r][i];if(!a)return!1;const c=((e,t,n)=>3*(t*n+e))(e&s.options.chunkSize-1,n&s.options.chunkSize-1,s.options.chunkSize);return a[c]=o[0],a[c+1]=o[1],a[c+2]=o[2],!0}getPixel(e,n){if("number"!=typeof e||"number"!=typeof n)return t("ChunkSystem.getPixel: failed to get pixel (invalid coords).");const o=Math.floor(e/s.options.chunkSize),r=Math.floor(n/s.options.chunkSize);if(!this.chunks[o])return;const i=this.chunks[o][r],a=((e,t,n)=>3*(t*n+e))(e&s.options.chunkSize-1,n&s.options.chunkSize-1,s.options.chunkSize);return[i[a],i[a+1],i[a+2]]}protectChunk(e,n){return"number"!=typeof e||"number"!=typeof n?t("ChunkSystem.protectChunk: failed to protect chunk (invalid coords)."):(this.chunkProtected[e]||(this.chunkProtected[e]=[]),this.chunkProtected[e][n]=!0)}unProtectChunk(e,n){return"number"!=typeof e||"number"!=typeof n?t("ChunkSystem.unprotectChunk: failed to unprotect chunk (invalid coords)."):!!this.chunkProtected[e]&&(this.chunkProtected[e][n]=!1,!0)}isProtected(e,n){return"number"!=typeof e||"number"!=typeof n?t("ChunkSystem.isProtected: failed to check (invalid coords)."):!!this.chunkProtected[e]&&Boolean(this.chunkProtected[e][n])}}const r=new o;class s{constructor(o={}){o.ws||(o.ws="wss://ourworldofpixels.com"),o.world||(o.world="main"),o.reconnectTime||(o.reconnectTime=5e3);const s=this;this.clientOptions=o,this.RANK={ADMIN:3,MODERATOR:2,USER:1,NONE:0},this.options={chunkSize:16,maxChatBuffer:256,maxMessageLength:{0:128,1:128,2:512,3:16384},maxWorldNameLength:24,worldBorder:16777215,opcode:{setId:0,worldUpdate:1,chunkLoad:2,teleport:3,setRank:4,captcha:5,setPQuota:6,chunkProtected:7},captchaState:{CA_WAITING:0,CA_VERIFYING:1,CA_VERIFIED:2,CA_OK:3,CA_INVALID:4},captchaStateNames:{0:"WAITING",1:"VERIFYING",2:"VERIFIED",3:"OK",4:"INVALID"}},void 0===window.document?this.options.misc={chatVerification:String.fromCharCode(10),tokenVerification:"CaptchA",worldVerification:25565}:this.options.misc={chatVerification:OWOP.options.serverAddress[0].proto.misc.chatVerification,tokenVerification:OWOP.options.serverAddress[0].proto.misc.tokenVerification,worldVerification:OWOP.options.serverAddress[0].proto.misc.worldVerification},s.chat={send:e=>"number"==typeof s.player.rank&&(e=s.chat.sendModifier(e),s.net.ws.send(e.substr(0,s.options.maxMessageLength[s.player.rank])+s.options.misc.chatVerification),!0),local(e){s.util.log(e)},sendModifier:e=>e,recvModifier:e=>e,messages:[]},s.world={join(e="main"){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;let t=[];e=e.toLowerCase();for(let n=0;n<e.length&&n<24;n++){let o=e.charCodeAt(n);(o<123&&o>96||o<58&&o>47||95===o||46===o)&&t.push(o)}let n=new ArrayBuffer(t.length+2),o=new DataView(n);for(let e=t.length;e--;)o.setUint8(e,t[e]);return o.setUint16(t.length,s.options.misc.worldVerification,!0),s.net.ws.send(n),s.util.log(`Joining world: ${e}`),s.world.name=e,!0},leave(){s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1,s.net.ws.close()},destroy(){s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1,s.net.destroyed=!0,s.net.ws.close(),s.emit("destroy")},move(e=0,t=0){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;s.player.x=e,s.player.y=t,e*=16,t*=16;const n=new DataView(new ArrayBuffer(12));return s.player.worldX=e,s.player.worldY=t,n.setInt32(0,e,!0),n.setInt32(4,t,!0),n.setUint8(8,s.player.color[0]),n.setUint8(9,s.player.color[1]),n.setUint8(10,s.player.color[2]),n.setUint8(11,s.player.tool),s.net.ws.send(n.buffer),!0},setPixel(e=s.player.x,t=s.player.y,n=s.player.color,o,r=!0){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected||s.player.rank===s.RANK.NONE)return!1;if(!s.net.bucket.canSpend(1))return!1;const i=s.player.x,a=s.player.y;r&&s.world.move(e,t);const c=new DataView(new ArrayBuffer(11));return c.setInt32(0,e,!0),c.setInt32(4,t,!0),c.setUint8(8,n[0]),c.setUint8(9,n[1]),c.setUint8(10,n[2]),s.player.color=n,s.net.ws.send(c.buffer),o&&s.world.move(i,a),!0},setTool(e=0){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;s.player.tool=e;const t=new DataView(new ArrayBuffer(12));return t.setInt32(0,s.player.worldX,!0),t.setInt32(4,s.player.worldY,!0),t.setUint8(8,s.player.color[0]),t.setUint8(9,s.player.color[1]),t.setUint8(10,s.player.color[2]),t.setUint8(11,e),s.net.ws.send(t.buffer),!0},setColor(e=[0,0,0]){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;s.player.color=e;const t=new DataView(new ArrayBuffer(12));return t.setInt32(0,s.player.worldX,!0),t.setInt32(4,s.player.worldY,!0),t.setUint8(8,s.player.color[0]),t.setUint8(9,s.player.color[1]),t.setUint8(10,s.player.color[2]),t.setUint8(11,s.player.tool),s.net.ws.send(t.buffer),!0},protectChunk(e=s.player.x,t=s.player.y,n=1){if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;if(s.player.rank<s.RANK.ADMIN&&!o.unsafe)return!1;const r=new DataView(new ArrayBuffer(10));return r.setInt32(0,e,!0),r.setInt32(4,t,!0),r.setUint8(8,n),s.net.ws.send(r.buffer),!0},clearChunk(e=s.player.x,t=s.player.y,n=s.player.color){if(s.player.rank===s.RANK.ADMIN||o.unsafe){const o=new DataView(new ArrayBuffer(13));return o.setInt32(0,e,!0),o.setInt32(4,t,!0),o.setUint8(8,n[0]),o.setUint8(9,n[1]),o.setUint8(10,n[2]),s.net.ws.send(o.buffer),!0}return!1},requestChunk(e,t,n){if(o.simpleChunks)return!0;if(1!==s.net.ws.readyState||!s.net.isWebsocketConnected)return!1;"number"!=typeof e&&"number"!=typeof t&&(e=s.player.x,t=s.player.y,n=!0),n&&(e=Math.floor(e/s.options.chunkSize),t=Math.floor(t/s.options.chunkSize));let r=s.options.worldBorder;if(e>r||t>r||e<~r||t<~r)return;let i=new DataView(new ArrayBuffer(8));return i.setInt32(0,e,!0),i.setInt32(4,t,!0),s.net.ws.send(i.buffer),!0},getPixel:(e=s.player.x,t=s.player.y)=>o.simpleChunks?OWOP.world.getPixel(e,t):(r.getChunk(e,t)||s.world.requestChunk(e,t,!0),r.getPixel(e,t))},s.player={x:0,y:0,worldX:0,worldY:0,tool:0,rank:null,id:null,color:[0,0,0]},s.players={},s.net={isWebsocketConnected:!1,isWorldConnected:!1,destroyed:!1,bucket:new i(32,4),async dataHandler(e){if("object"!=typeof e)return t("Client.net.dataHandler: data is not object.");const a=e;switch((e=new DataView(e)).getUint8(0)){case s.options.opcode.setId:s.emit("id",e.getUint32(1,!0)),s.player.id=e.getUint32(1,!0),s.net.isWorldConnected=!0,"number"!=typeof s.player.rank&&(s.player.rank=s.RANK.NONE),s.util.log(`Joined world '${s.world.name}' and got id '${e.getUint32(1,!0)}'`,"color: #00ff00"),o.adminlogin&&s.chat.send("/adminlogin "+o.adminlogin),o.modlogin&&s.chat.send("/modlogin "+o.modlogin),o.pass&&s.chat.send("/pass "+o.pass),s.emit("join",s.world.name);break;case s.options.opcode.worldUpdate:{let t=!1,n={};for(let o=e.getUint8(1);o--;){t=!0;let r=e.getUint32(2+16*o,!0);if(r===s.player.id)continue;let i=e.getUint32(2+16*o+4,!0),a=e.getUint32(2+16*o+8,!0),c=e.getUint8(2+16*o+12),l=e.getUint8(2+16*o+13),d=e.getUint8(2+16*o+14),u=e.getUint8(2+16*o+15);n[r]={x:i,y:a,rgb:[c,l,d],tool:u}}if(t)for(let e in n)s.players[e]||s.emit("connect",e),s.players[e]={id:e,x:n[e].x>>4,y:n[e].y>>4,rgb:n[e].rgb,tool:n[e].tool},s.emit("update",s.players[e]);let o=2+16*e.getUint8(1);for(let t=e.getUint16(o,!0),n=0;n<t;n++){let t=e.getInt32(2+o+15*n+4,!0),i=e.getInt32(2+o+15*n+8,!0),a=e.getUint8(2+o+15*n+12),c=e.getUint8(2+o+15*n+13),l=e.getUint8(2+o+15*n+14);s.emit("pixel",t,i,[a,c,l]),r.setPixel(t,i,[a,c,l])}o+=15*e.getUint16(o,!0)+2;for(let t=e.getUint8(o);t--;){let n=e.getUint32(1+o+4*t,!0);s.players[n]&&(s.emit("disconnect",s.players[n]),delete s.players[n])}break}case s.options.opcode.chunkLoad:{let t=e.getInt32(1,!0),n=e.getInt32(5,!0),o=!!e.getUint8(9),i=new Uint8Array(a,10,a.byteLength-10),c=s.util.decompress(i);r.setChunk(t,n,c),o&&r.protectChunk(t,n),s.emit("chunk",t,n,c,o);break}case s.options.opcode.teleport:{if(!o.teleport)break;const t=e.getInt32(1,!0),n=e.getInt32(5,!0);s.world.move(t,n),s.emit("teleport",t,n);break}case s.options.opcode.setRank:s.player.rank=e.getUint8(1),s.emit("rank",e.getUint8(1));break;case s.options.opcode.captcha:switch(e.getUint8(1)){case s.options.captchaState.CA_WAITING:s.util.log("CaptchaState: WAITING (0)","color: #ffff00"),o.captchapass?(s.net.ws.send(s.options.misc.tokenVerification+"LETMEINPLZ"+o.captchapass),s.util.log("Used captchapass.","color: #00ff00")):o.renderCaptcha&&s.net.ws.send(OWOP.options.serverAddress[0].proto.misc.tokenVerification+await n());break;case s.options.captchaState.CA_VERIFYING:s.util.log("CaptchaState: VERIFYING (1)","color: #ffff00");break;case s.options.captchaState.CA_VERIFIED:s.util.log("CaptchaState: VERIFIED (2)","color: #00ff00");break;case s.options.captchaState.CA_OK:s.util.log("CaptchaState: OK (3)","color: #00ff00"),s.world.join(o.world);break;case s.options.captchaState.CA_INVALID:s.util.log("CaptchaState: INVALID (4)","color: #ff0000"),s.util.log("Captcha failed. Websocket is invalid now.","color: #ff0000"),s.net.destroyed=!0,s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1,s.emit("destroy")}s.emit("captcha",e.getUint8(1));break;case s.options.opcode.setPQuota:{let t=e.getUint16(1,!0),n=e.getUint16(3,!0);s.net.bucket=new i(t,n),s.emit("pquota",t,n),s.util.log(`New PQuota: ${t}x${n}`);break}case s.options.opcode.chunkProtected:{let t=e.getInt32(1,!0),n=e.getInt32(5,!0),o=e.getUint8(9);o?r.protectChunk(t,n):r.unProtectChunk(t,n),s.emit("chunkProtect",t,n,o);break}}},messageHandler(e){if("string"!=typeof e)return t("Client.net.messageHandler: data is not string.");if(e.startsWith("You are banned"))return s.util.log("Got ban message.","color: #ff0000"),s.emit("destroy"),s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1,s.net.destroyed=!0;if(e.startsWith("DEV")&&s.util.log("[DEV] "+e.slice(3)),e.startsWith("<"))return;(e=s.chat.recvModifier(e)).split(":")[0];s.emit("message",e),s.chat.messages.push(e),s.chat.messages.length>s.options.maxChatBuffer&&s.chat.messages.shift()}},function t(){let n=new e(o.ws);n.binaryType="arraybuffer",n.onopen=(()=>{s.util.log("WebSocket connected!","color: #00ff00"),s.net.isWebsocketConnected=!0,s.emit("open")}),n.onmessage=(e=>{s.emit("rawMessage",e.data),"string"==typeof e.data?s.net.messageHandler(e.data):"object"==typeof e.data&&s.net.dataHandler(e.data)}),n.onclose=(()=>{s.emit("close"),s.util.log("WebSocket disconnected!","color: #ff0000"),s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1,o.reconnect&&!s.net.destroyed&&setTimeout(t,o.reconnectTime)}),n.onerror=(()=>{s.util.log("WebSocket error!","color: #ff0000"),s.net.isWorldConnected=!1,s.net.isWebsocketConnected=!1}),s.net.ws=n}(),s.util={log(...e){o.noLog||(o.id?console.log(`[${o.id}] ${e}`):s.player.id?console.log(`%c [${s.player.id}] `+e[0],e[1]):console.log("%c [?] "+e[0],e[1]))},decompress(e){for(var t=e[1]<<8|e[0],n=new Uint8Array(t),o=e[3]<<8|e[2],r=2*o+4,s=0,i=r,a=0;a<o;a++){for(var c=(e[4+2*a+1]<<8|e[4+2*a])+r;i<c;)n[s++]=e[i++];var l=e[i+1]<<8|e[i],d=e[i+2],u=e[i+3],h=e[i+4];for(i+=5;l--;)n[s]=d,n[s+1]=u,n[s+2]=h,s+=3}for(;i<e.length;)n[s++]=e[i++];return n}},o.unsafe&&s.util.log("Using 'unsafe' option.","color: #ffff00"),this._events={}}on(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}once(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push([t])}emit(e,...t){if(this._events[e])for(let n in this._events[e])"function"==typeof this._events[e][n]?this._events[e][n](...t):(this._events[e][n][0](...t),this._events[e].splice(n,1))}off(e,t){if(this._events[e])for(let n in this._events[e])String(this._events[e][n])===String(t)&&this._events[e].splice(n,1)}}s.RANK={ADMIN:3,MODERATOR:2,USER:1,NONE:0},s.options={chunkSize:16,maxChatBuffer:256,maxMessageLength:{0:128,1:128,2:512,3:16384},maxWorldNameLength:24,worldBorder:16777215,opcode:{setId:0,worldUpdate:1,chunkLoad:2,teleport:3,setRank:4,captcha:5,setPQuota:6,chunkProtected:7},captchaState:{CA_WAITING:0,CA_VERIFYING:1,CA_VERIFIED:2,CA_OK:3,CA_INVALID:4},captchaStateNames:{0:"WAITING",1:"VERIFYING",2:"VERIFIED",3:"OK",4:"INVALID"}},void 0===window.document?s.options.misc={chatVerification:String.fromCharCode(10),tokenVerification:"CaptchA",worldVerification:25565}:s.options.misc={chatVerification:OWOP.options.serverAddress[0].proto.misc.chatVerification,tokenVerification:OWOP.options.serverAddress[0].proto.misc.tokenVerification,worldVerification:OWOP.options.serverAddress[0].proto.misc.worldVerification};class i{constructor(e,t,n){this.lastCheck=Date.now(),this.allowance=e,this.rate=e,this.time=t,this.infinite=n}update(){this.allowance+=(Date.now()-this.lastCheck)/1e3*(this.rate/this.time),this.lastCheck=Date.now(),this.allowance>this.rate&&(this.allowance=this.rate)}canSpend(e){return!!this.infinite||(this.update(),!(this.allowance<e)&&(this.allowance-=e,!0))}}return console.log("OJS loaded"),{install:()=>{},uninstall:()=>{alert("Refresh page to uninstall.")},Client:s,ChunkSystem:o,Chunks:r,Bucket:i}})();e=function(e){const t=document.createElement("iframe");return document.head.append(t),t.contentWindow[e]}("WebSocket");const n=OWOP.tool.addToolObject,o=OWOP.tool.class,r=OWOP.cursors,s=OWOP.tool.allTools,i=OWOP.fx.player,a=OWOP.RANK,c=OWOP.tool.updateToolbar,l=OWOP.misc,d=OWOP.windowSys,u=OWOP.player,h=OWOP.require("conf").protocol,p=OWOP.windowSys.class.window;let f,m,w,y,g,k=!1,b=!1;const C=[],O=[],I=[],v=new p("SOBv2",{},e=>{const n=document.createElement("span");n.innerText="WS";const o=document.createElement("input");o.type="text",o.placeholder="Default (local)",o.oninput=(()=>{(g=o.value)||(g=void 0)});const r=document.createElement("button");r.innerText="Connect",r.onclick=(()=>{C.push(new t.Client({simpleChunks:!0,renderCaptcha:!0,world:l.world.name,ws:g,reconnect:!0}))});const s=document.createElement("button");s.innerText="Disconnect",s.onclick=(()=>{for(;C.length;)C.pop().world.destroy()});const i=document.createElement("button");i.innerText="Clear queue",i.onclick=(()=>{for(;O.length;)O.pop();for(;I.length;)I.pop()});const a=document.createElement("span");a.innerText="QI";const c=document.createElement("input");c.type="number",c.value=100,c.oninput=(()=>{clearInterval(f),f=setInterval(S,parseInt(c.value))});const d=document.createElement("span");d.innerText="Permanent";const u=document.createElement("input");u.type="checkbox",u.onchange=(()=>{k=u.checked});const h=document.createElement("span");h.innerText="Sneaky";const p=document.createElement("input");p.type="checkbox",p.onchange=(()=>{b=p.checked});const m=document.createElement("span");m.innerHTML='Connected: <span class="sobv2_connected_bots"></span> | Total: <span class="sobv2_bots"></span>',e.addObj(n),e.addObj(o),e.addObj(document.createElement("br")),e.addObj(r),e.addObj(s),e.addObj(i),e.addObj(document.createElement("br")),e.addObj(a),e.addObj(c),e.addObj(document.createElement("br")),e.addObj(d),e.addObj(u),e.addObj(document.createElement("br")),e.addObj(h),e.addObj(p),e.addObj(document.createElement("br")),e.addObj(m)}),S=()=>{for(const e of C.filter(e=>e.net.isWorldConnected&&e.net.isWebsocketConnected)){let t=!1,n=0;for(;!t&&O.length&&!(n>256);){const o=O.shift();let r=e.world.getPixel(o.position[0],o.position[1]);r?r[0]===o.color[0]&&r[1]===o.color[1]&&r[2]===o.color[2]||(e.world.setPixel(o.position[0],o.position[1],o.color,b),t=!0):(O.push(o),t=!0),n++}}if(!O.length)for(const e of I)O.push(e);document.querySelector("#reconnect-btn").offsetParent&&document.querySelector("#reconnect-btn").click(),document.querySelector(".sobv2_connected_bots").innerText=C.filter(e=>e.net.isWorldConnected&&e.net.isWebsocketConnected).length,document.querySelector(".sobv2_bots").innerText=C.length};return{install:function(){d.addWindow(v.move(window.innerWidth-500,100)),m=new o("SOBv2 Chunk",r.erase,i.RECT_SELECT_ALIGNED(16),a.USER,e=>{let t;e.setEvent("mousedown mousemove",e=>{if(1&e.buttons)t=u.selectedColor;else{if(!(2&e.buttons))return;t=[255,255,255]}let n=Math.floor(e.tileX/h.chunkSize),o=Math.floor(e.tileY/h.chunkSize);const r=[];for(let e=0;e<16;e++)for(let s=0;s<16;s++){let i=16*n+s,a=16*o+e;r.push({position:[i,a],color:t})}r.sort(()=>Math.random()-.5);for(const e of r)k?I.push(e):O.push(e)})}),n(m),w=new o("SOBv2 Paste",r.paste,i.NONE,a.USER,e=>{const t=[];e.setEvent("select",()=>{const e=new p("SOBv2 Paste",{},n=>{const o=document.createElement("input");for(o.type="file",o.onchange=(()=>{const n=o.files[0],r=new FileReader;r.readAsDataURL(n),r.onload=(()=>{const o=new Image;o.src=r.result,o.onload=(()=>{const r=document.createElement("canvas");r.width=o.width,r.height=o.height,r.getContext("2d").drawImage(o,0,0);const s=r.getContext("2d").getImageData(0,0,o.width,o.height).data;for(let e=0;e<o.height;e++)for(let n=0;n<o.width;n++){const r=e*o.width*4+4*n;s[r+3]&&t.push({position:[n,e],color:[s[r],s[r+1],s[r+2]]})}n.value=null,e.close()})})});t.length;)t.pop();n.addObj(o)});d.addWindow(e.move(window.innerWidth-500,100))}),e.setEvent("mousedown",e=>{if(!(1&e.buttons))return;let n=e.tileX,o=e.tileY;const r=structuredClone(t);r.forEach(e=>e.position[0]+=n),r.forEach(e=>e.position[1]+=o),r.sort(()=>Math.random()-.5);for(const e of r)k?I.push(e):O.push(e)})}),n(w),y=new o("SOBv2 Text",r.write,i.NONE,a.USER,e=>{const t=[],n=new p("SOBv2 Text",{},e=>{const o=document.createElement("input");o.type="text",o.placeholder="Text";const r=document.createElement("input");r.type="text",r.placeholder="Font";const s=document.createElement("input");s.type="number",s.placeholder="Size";const i=document.createElement("button");i.type="button",i.innerText="Done",i.onclick=(()=>{const e=document.createElement("canvas"),i=e.getContext("2d");i.font=`${s.value}px ${r.value}`;const a=i.measureText(o.value);e.width=Math.ceil(a.width),e.height=s.value,i.fillStyle="white",i.fillRect(0,0,e.width,e.height),i.fillStyle="black",i.textBaseline="top",i.font=`${s.value}px ${r.value}`,i.fillText(o.value,0,0);const c=i.getImageData(0,0,e.width,e.height).data;for(let n=0;n<e.height;n++)for(let o=0;o<e.width;o++){const r=n*e.width*4+4*o;t.push({position:[o,n],color:[c[r],c[r+1],c[r+2]]})}n.close()}),e.addObj(o),e.addObj(document.createElement("br")),e.addObj(r),e.addObj(document.createElement("br")),e.addObj(s),e.addObj(document.createElement("br")),e.addObj(i)});e.setEvent("select",()=>{for(;t.length;)t.pop();d.addWindow(n.move(window.innerWidth-500,100))}),e.setEvent("mousedown",e=>{if(!(1&e.buttons))return;let n=e.tileX,o=e.tileY;const r=structuredClone(t);r.forEach(e=>e.position[0]+=n),r.forEach(e=>e.position[1]+=o),r.sort(()=>Math.random()-.5);for(const e of r)k?I.push(e):O.push(e)})}),n(y),f=setInterval(S,100)},uninstall:function(){clearInterval(f),delete s[m.id],delete s[w.id],c(),v.close()}}})().install()})();